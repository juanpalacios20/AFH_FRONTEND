<p-dialog
  header="Informacion del ticket"
  [(visible)]="visible"
  [modal]="true"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
  [closable]="true"
  (onHide)="close()"
>
  <div class="card flex flex-col items-startS mb-4" >
    <div class="flex items-center gap-4 mb-2">
      <p class="text-gray-700 font-semibold text-lg m-0">
        <span class="text-black font-bold">Herramientas:</span>
      </p>
      <p-button
        type="button"
        size="small"
        label="Ver herramientas"
        (onClick)="togglePopover($event)"
        styleClass="min-w-48"
      />
    </div>

    <p-popover #herramientasPopover>
      <div class="flex flex-col gap-4 w-64">
        <div>
          <span class="font-medium block mb-2">Herramientas solicitadas</span>
          <ul class="list-none p-0 m-0 flex flex-col">
            <li
              *ngFor="let tool of ticket.tools"
              class="flex items-center gap-3 px-2 py-2 hover:bg-emphasis cursor-pointer rounded-border"
            >
              <img
                [src]="tool.image"
                alt="{{ tool.name }}"
                class="w-8 h-8 object-cover rounded"
              />
              <span class="font-medium">{{ tool.name }}</span>
            </li>
          </ul>
        </div>
      </div>
    </p-popover>

    <p class="text-gray-700 font-semibold text-lg mb-1">
      <span class="text-black font-bold">Código:</span> {{ ticket?.id }}
    </p>
    <p class="text-gray-700 font-semibold text-lg">
      <span class="text-black font-bold">Estado:</span>
      <p-tag
        class="justify-center"
        [value]="getStateString(ticket.state)"
        [severity]="getSeverity(ticket.state)"
      ></p-tag>
    </p>
    <p class="text-gray-700 font-semibold text-lg mb-1">
      <span class="text-black font-bold">Solicitante:</span>
      {{ ticket.applicant.user.first_name }}
      {{ ticket.applicant.user.last_name }}
    </p>
    <p class="text-gray-700 font-semibold text-lg mb-1" *ngIf="ticket">
      <span class="text-black font-bold">Destino:</span>
      {{ ticket.place }}
    </p>
    <p class="text-gray-700 font-semibold text-lg mb-1">
      <span class="text-black font-bold" >Fecha y hora de solicitud:</span>
      {{ ticket.entry_date_formatted }}
    </p>
    <p class="text-gray-700 font-semibold text-lg mb-1">
      <span class="text-black font-bold">Descripción:</span>
      {{ ticket.description }}
    </p>
    <div class="flex justify-end gap-4 mt-2">
      <p-button
        *ngIf="ticket.state === 3"
        type="button"
        label="Rechazar"
        (onClick)="changeState(ticket.id, 2)"
        styleClass="p-button-secondary"
      ></p-button>
      <p-button
        *ngIf="ticket.state === 3"
        type="button"
        label="Aceptar"
        (onClick)="changeState(ticket.id, 1)"
        styleClass="p-button-primary"
      ></p-button>
      <p-button
        *ngIf="ticket.state === 1"
        type="button"
        label="Completar"
        (onClick)="changeState(ticket.id, 4)"
        styleClass="p-button-primary"
      ></p-button>
    </div>
  </div>
</p-dialog>
